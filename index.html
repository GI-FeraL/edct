<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ED Colonization Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .success {
            color: #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid rgba(78, 205, 196, 0.3);
        }
        
        .hidden {
            display: none;
        }
        
        .project-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .material-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
        }
        
        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            transition: width 0.3s ease;
        }
        
        .contribution-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .contribution-form input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .contribution-form .btn {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .link-section {
            background: rgba(78, 205, 196, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .project-link {
            color: #4ecdc4;
            font-size: 1.2rem;
            text-decoration: none;
            word-break: break-all;
        }
        
        .project-link:hover {
            text-decoration: underline;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4ecdc4;
        }
        
        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Elite Dangerous Colonization Tracker</h1>
            <p>Coordinate material contributions for your squadron's colonization efforts!</p>
        </div>

        <!-- Project Selection/Creation -->
        <div id="projectSelection" class="card">
            <h2>Join or Create Project</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3>Join Existing Project</h3>
                    <input type="text" id="joinProjectInput" class="input" placeholder="Enter project ID (e.g., WEWE)">
                    <button class="btn" onclick="joinProject()">Join Project</button>
                </div>
                <div>
                    <h3>Create New Project</h3>
                    <select id="stationTypeSelect" class="input">
                        <option value="">Select Station Type</option>
                        <option value="coriolis_starport">Coriolis Starport</option>
                        <option value="orbis_starport">Orbis Starport</option>
                        <option value="ocellus_starport">Ocellus Starport</option>
                        <option value="asteroid_base">Asteroid Base</option>
                        <option value="planetary_outpost">Planetary Outpost</option>
                        <option value="ground_settlement">Ground Settlement</option>
                    </select>
                    <input type="text" id="projectNameInput" class="input" placeholder="Enter custom project name">
                    <button class="btn" onclick="createProject()">Create Project</button>
                </div>
            </div>
            <div id="errorMessage" class="error hidden"></div>
            <div id="successMessage" class="success hidden"></div>
        </div>

        <!-- Project Display -->
        <div id="projectDisplay" class="hidden">
            <div class="card">
                <div class="project-info">
                    <div>
                        <h2 id="projectTitle">Project Title</h2>
                        <p id="projectDescription">Project Description</p>
                    </div>
                    <div class="link-section">
                        <p><strong>Share this link:</strong></p>
                        <a id="projectLink" class="project-link" href="#" target="_blank">Project Link</a>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalMaterials">0</div>
                        <div class="stat-label">Total Materials</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="contributedMaterials">0</div>
                        <div class="stat-label">Contributed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completionPercentage">0%</div>
                        <div class="stat-label">Complete</div>
                    </div>
                </div>

                <div id="materialsList">
                    <!-- Materials will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Station types and their required materials
        const stationTypes = {
            coriolis_starport: {
                name: 'Coriolis Starport',
                materials: {
                    'Aluminium': 2500000,
                    'Beryllium': 350000,
                    'Copper': 750000,
                    'Gold': 25000,
                    'Indium': 125000,
                    'Lithium': 125000,
                    'Nickel': 750000,
                    'Palladium': 25000,
                    'Platinum': 5000,
                    'Silver': 25000,
                    'Titanium': 250000,
                    'Uranium': 125000
                }
            },
            orbis_starport: {
                name: 'Orbis Starport',
                materials: {
                    'Aluminium': 1500000,
                    'Beryllium': 200000,
                    'Copper': 500000,
                    'Gold': 15000,
                    'Indium': 75000,
                    'Lithium': 75000,
                    'Nickel': 500000,
                    'Palladium': 15000,
                    'Platinum': 3000,
                    'Silver': 15000,
                    'Titanium': 150000,
                    'Uranium': 75000
                }
            },
            ocellus_starport: {
                name: 'Ocellus Starport',
                materials: {
                    'Aluminium': 1000000,
                    'Beryllium': 150000,
                    'Copper': 350000,
                    'Gold': 10000,
                    'Indium': 50000,
                    'Lithium': 50000,
                    'Nickel': 350000,
                    'Palladium': 10000,
                    'Platinum': 2000,
                    'Silver': 10000,
                    'Titanium': 100000,
                    'Uranium': 50000
                }
            },
            asteroid_base: {
                name: 'Asteroid Base',
                materials: {
                    'Aluminium': 500000,
                    'Beryllium': 75000,
                    'Copper': 175000,
                    'Gold': 5000,
                    'Indium': 25000,
                    'Lithium': 25000,
                    'Nickel': 175000,
                    'Palladium': 5000,
                    'Platinum': 1000,
                    'Silver': 5000,
                    'Titanium': 50000,
                    'Uranium': 25000
                }
            },
            planetary_outpost: {
                name: 'Planetary Outpost',
                materials: {
                    'Aluminium': 750000,
                    'Beryllium': 100000,
                    'Copper': 250000,
                    'Gold': 7500,
                    'Indium': 37500,
                    'Lithium': 37500,
                    'Nickel': 250000,
                    'Palladium': 7500,
                    'Platinum': 1500,
                    'Silver': 7500,
                    'Titanium': 75000,
                    'Uranium': 37500
                }
            },
            ground_settlement: {
                name: 'Ground Settlement',
                materials: {
                    'Aluminium': 250000,
                    'Beryllium': 35000,
                    'Copper': 75000,
                    'Gold': 2500,
                    'Indium': 12500,
                    'Lithium': 12500,
                    'Nickel': 75000,
                    'Palladium': 2500,
                    'Platinum': 500,
                    'Silver': 2500,
                    'Titanium': 25000,
                    'Uranium': 12500
                }
            }
        };

        let currentProject = null;

        // Load project from localStorage on page load
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('project');
            
            if (projectId) {
                loadProject(projectId);
            } else {
                // Check if there's a saved project
                const savedProject = localStorage.getItem('edct_current_project');
                if (savedProject) {
                    currentProject = JSON.parse(savedProject);
                    displayProject();
                }
            }
        };

        // Listen for storage changes to sync across tabs
        window.addEventListener('storage', function(e) {
            if (e.key && e.key.startsWith('edct_project_')) {
                const urlParams = new URLSearchParams(window.location.search);
                const currentProjectId = urlParams.get('project');
                const changedProjectId = e.key.replace('edct_project_', '');
                
                if (currentProjectId === changedProjectId && e.newValue) {
                    currentProject = JSON.parse(e.newValue);
                    displayProject();
                }
            }
        });

        function createProject() {
            const stationType = document.getElementById('stationTypeSelect').value;
            const projectName = document.getElementById('projectNameInput').value.trim().toUpperCase();
            
            if (!stationType) {
                showError('Please select a station type');
                return;
            }
            
            if (!projectName) {
                showError('Please enter a project name');
                return;
            }

            if (projectName.length < 3) {
                showError('Project name must be at least 3 characters');
                return;
            }

            // Check if project already exists
            const existingProject = localStorage.getItem(`edct_project_${projectName}`);
            if (existingProject) {
                showError('Project name already exists. Please choose a different name.');
                return;
            }

            // Create new project
            const project = {
                id: projectName,
                stationType: stationType,
                stationName: stationTypes[stationType].name,
                requiredMaterials: { ...stationTypes[stationType].materials },
                contributedMaterials: {},
                createdAt: new Date().toISOString()
            };

            // Initialize contributed materials
            for (const material in project.requiredMaterials) {
                project.contributedMaterials[material] = 0;
            }

            // Save project
            localStorage.setItem(`edct_project_${projectName}`, JSON.stringify(project));
            localStorage.setItem('edct_current_project', JSON.stringify(project));
            
            currentProject = project;
            
            showSuccess(`Project "${projectName}" created successfully!`);
            displayProject();
            
            // Update URL and redirect to project
            window.history.pushState({}, '', `?project=${projectName}`);
            
            // Show the project link prominently
            setTimeout(() => {
                const linkDiv = document.createElement('div');
                linkDiv.className = 'success';
                linkDiv.style.marginTop = '20px';
                linkDiv.innerHTML = `
                    <strong>Project created! Share this link:</strong><br>
                    <a href="${window.location.href}" target="_blank" style="color: #4ecdc4; word-break: break-all;">${window.location.href}</a>
                `;
                document.getElementById('projectDisplay').insertBefore(linkDiv, document.getElementById('projectDisplay').firstChild);
            }, 1000);
        }

        function joinProject() {
            const projectId = document.getElementById('joinProjectInput').value.trim().toUpperCase();
            
            if (!projectId) {
                showError('Please enter a project ID');
                return;
            }

            loadProject(projectId);
        }

        function loadProject(projectId) {
            const project = localStorage.getItem(`edct_project_${projectId}`);
            
            if (!project) {
                showError('Project not found. Please check the project ID.');
                return;
            }

            currentProject = JSON.parse(project);
            localStorage.setItem('edct_current_project', JSON.stringify(currentProject));
            
            showSuccess(`Joined project "${projectId}"`);
            displayProject();
            
            // Update URL
            window.history.pushState({}, '', `?project=${projectId}`);
        }

        function displayProject() {
            if (!currentProject) return;

            document.getElementById('projectSelection').classList.add('hidden');
            document.getElementById('projectDisplay').classList.remove('hidden');

            // Update project info
            document.getElementById('projectTitle').textContent = currentProject.stationName;
            document.getElementById('projectDescription').textContent = `Project ID: ${currentProject.id}`;
            
            // Update project link
            const projectLink = `${window.location.origin}${window.location.pathname}?project=${currentProject.id}`;
            document.getElementById('projectLink').href = projectLink;
            document.getElementById('projectLink').textContent = projectLink;

            // Update stats
            updateStats();

            // Display materials
            displayMaterials();
        }

        function displayMaterials() {
            const materialsList = document.getElementById('materialsList');
            materialsList.innerHTML = '';

            for (const material in currentProject.requiredMaterials) {
                const required = currentProject.requiredMaterials[material];
                const contributed = currentProject.contributedMaterials[material] || 0;
                const remaining = Math.max(0, required - contributed);
                const percentage = Math.min(100, (contributed / required) * 100);

                const materialDiv = document.createElement('div');
                materialDiv.className = 'material-item';
                materialDiv.innerHTML = `
                    <div class="material-header">
                        <h3>${material}</h3>
                        <span>${contributed.toLocaleString()} / ${required.toLocaleString()}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div class="contribution-form">
                        <input type="number" id="contribute_${material}" placeholder="Enter amount" min="0" max="${remaining}">
                        <button class="btn" onclick="contributeMaterial('${material}')">Contribute</button>
                        <span style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Remaining: ${remaining.toLocaleString()}</span>
                    </div>
                `;
                materialsList.appendChild(materialDiv);
            }
        }

        function contributeMaterial(material) {
            const input = document.getElementById(`contribute_${material}`);
            const amount = parseInt(input.value);

            if (!amount || amount <= 0) {
                showError('Please enter a valid amount');
                return;
            }

            const required = currentProject.requiredMaterials[material];
            const currentContributed = currentProject.contributedMaterials[material] || 0;
            const remaining = required - currentContributed;

            if (amount > remaining) {
                showError(`Cannot contribute more than ${remaining.toLocaleString()} units`);
                return;
            }

            // Update project
            currentProject.contributedMaterials[material] = currentContributed + amount;
            
            // Save project
            localStorage.setItem(`edct_project_${currentProject.id}`, JSON.stringify(currentProject));
            localStorage.setItem('edct_current_project', JSON.stringify(currentProject));

            // Clear input
            input.value = '';

            // Update display
            updateStats();
            displayMaterials();

            showSuccess(`Contributed ${amount.toLocaleString()} ${material}`);
        }

        function updateStats() {
            if (!currentProject) return;

            const totalMaterials = Object.keys(currentProject.requiredMaterials).length;
            let totalRequired = 0;
            let totalContributed = 0;

            for (const material in currentProject.requiredMaterials) {
                totalRequired += currentProject.requiredMaterials[material];
                totalContributed += currentProject.contributedMaterials[material] || 0;
            }

            const completionPercentage = Math.round((totalContributed / totalRequired) * 100);

            document.getElementById('totalMaterials').textContent = totalMaterials;
            document.getElementById('contributedMaterials').textContent = totalContributed.toLocaleString();
            document.getElementById('completionPercentage').textContent = completionPercentage + '%';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
            
            setTimeout(() => {
                successDiv.classList.add('hidden');
            }, 3000);
        }

        // Add back to home functionality
        function goHome() {
            window.location.href = window.location.pathname;
        }
    </script>
</body>
</html>